"use strict";var zt=Object.defineProperty;var Qt=(t,n,e)=>n in t?zt(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e;var _=(t,n,e)=>(Qt(t,typeof n!="symbol"?n+"":n,e),e);Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const v=require("obsidian"),Zt=t=>t&&typeof t=="object"&&"default"in t?t:{default:t},Gt=Zt(v);function O(){}function St(t){return t()}function ft(){return Object.create(null)}function D(t){t.forEach(St)}function ct(t){return typeof t=="function"}function bt(t,n){return t!=t?n==n:t!==n||t&&typeof t=="object"||typeof t=="function"}function Kt(t){return Object.keys(t).length===0}function Lt(t){return t&&ct(t.destroy)?t.destroy:O}function N(t,n){t.appendChild(n)}function V(t,n,e){t.insertBefore(n,e||null)}function T(t){t.parentNode&&t.parentNode.removeChild(t)}function Jt(t,n){for(let e=0;e<t.length;e+=1)t[e]&&t[e].d(n)}function S(t){return document.createElement(t)}function Ft(t){return document.createTextNode(t)}function W(){return Ft(" ")}function R(t,n,e,i){return t.addEventListener(n,e,i),()=>t.removeEventListener(n,e,i)}function F(t,n,e){e==null?t.removeAttribute(n):t.getAttribute(n)!==e&&t.setAttribute(n,e)}function Xt(t){return Array.from(t.childNodes)}function te(t,n){n=""+n,t.wholeText!==n&&(t.data=n)}let dt;function H(t){dt=t}const I=[],it=[],X=[],ht=[],ee=Promise.resolve();let ot=!1;function ne(){ot||(ot=!0,ee.then(Pt))}function rt(t){X.push(t)}const nt=new Set;let Z=0;function Pt(){const t=dt;do{for(;Z<I.length;){const n=I[Z];Z++,H(n),ie(n.$$)}for(H(null),I.length=0,Z=0;it.length;)it.pop()();for(let n=0;n<X.length;n+=1){const e=X[n];nt.has(e)||(nt.add(e),e())}X.length=0}while(I.length);for(;ht.length;)ht.pop()();ot=!1,nt.clear(),H(t)}function ie(t){if(t.fragment!==null){t.update(),D(t.before_update);const n=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,n),t.after_update.forEach(rt)}}const tt=new Set;let P;function oe(){P={r:0,c:[],p:P}}function re(){P.r||D(P.c),P=P.p}function Y(t,n){t&&t.i&&(tt.delete(t),t.i(n))}function st(t,n,e,i){if(t&&t.o){if(tt.has(t))return;tt.add(t),P.c.push(()=>{tt.delete(t),i&&(e&&t.d(1),i())}),t.o(n)}else i&&i()}function se(t){t&&t.c()}function Dt(t,n,e,i){const{fragment:o,after_update:r}=t.$$;o&&o.m(n,e),i||rt(()=>{const s=t.$$.on_mount.map(St).filter(ct);t.$$.on_destroy?t.$$.on_destroy.push(...s):D(s),t.$$.on_mount=[]}),r.forEach(rt)}function Mt(t,n){const e=t.$$;e.fragment!==null&&(D(e.on_destroy),e.fragment&&e.fragment.d(n),e.on_destroy=e.fragment=null,e.ctx=[])}function ae(t,n){t.$$.dirty[0]===-1&&(I.push(t),ne(),t.$$.dirty.fill(0)),t.$$.dirty[n/31|0]|=1<<n%31}function Ct(t,n,e,i,o,r,s,c=[-1]){const d=dt;H(t);const a=t.$$={fragment:null,ctx:[],props:r,update:O,not_equal:o,bound:ft(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(d?d.$$.context:[])),callbacks:ft(),dirty:c,skip_bound:!1,root:n.target||d.$$.root};s&&s(a.root);let u=!1;if(a.ctx=e?e(t,n.props||{},(l,w,...m)=>{const p=m.length?m[0]:w;return a.ctx&&o(a.ctx[l],a.ctx[l]=p)&&(!a.skip_bound&&a.bound[l]&&a.bound[l](p),u&&ae(t,l)),w}):[],a.update(),u=!0,D(a.before_update),a.fragment=i?i(a.ctx):!1,n.target){if(n.hydrate){const l=Xt(n.target);a.fragment&&a.fragment.l(l),l.forEach(T)}else a.fragment&&a.fragment.c();n.intro&&Y(t.$$.fragment),Dt(t,n.target,n.anchor,n.customElement),Pt()}H(d)}class Ot{$destroy(){Mt(this,1),this.$destroy=O}$on(n,e){if(!ct(e))return O;const i=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return i.push(e),()=>{const o=i.indexOf(e);o!==-1&&i.splice(o,1)}}$set(n){this.$$set&&!Kt(n)&&(this.$$.skip_bound=!0,this.$$set(n),this.$$.skip_bound=!1)}}const G=new WeakMap;function pt(t){return t.containerEl.matches(".dn-editor.dn-leaf-view .workspace-leaf")}function le(t){const n=[];for(let e=0;e<t;e++)n.push((16*Math.random()|0).toString(16));return n.join("")}function ce(t){const n=function(){return Object.setPrototypeOf(new v.Component,new.target.prototype)};return n.prototype=t.prototype,Object.setPrototypeOf(n,t)}const de=(t,n,e,i)=>{let o=app.workspace.activeLeaf;return o||(o=e),n||(n=o==null?void 0:o.containerEl),new C(o,n,t,void 0,i).attachLeaf()};var _t,kt,Et,Nt;const et=class extends ce(v.HoverPopover){constructor(e,i,o,r,s){super();_(this,"onTarget");_(this,"setActive");_(this,"lockedOut");_(this,"abortController",this.addChild(new v.Component));_(this,"detaching",!1);_(this,"opening",!1);_(this,"rootSplit",new v.WorkspaceSplit(window.app.workspace,"vertical"));_(this,"isPinned",!0);_(this,"titleEl");_(this,"containerEl");_(this,"oldPopover",(_t=this.parent)==null?void 0:_t.DailyNoteEditor);_(this,"document",(Nt=(Et=(kt=this.targetEl)==null?void 0:kt.ownerDocument)!=null?Et:window.activeDocument)!=null?Nt:window.document);_(this,"id",le(8));_(this,"bounce");_(this,"boundOnZoomOut");_(this,"originalPath");_(this,"originalLinkText");_(this,"hoverEl",this.document.defaultView.createDiv({cls:"dn-editor dn-leaf-view",attr:{id:"dn-"+this.id}}));this.targetEl=i,this.plugin=o,this.onShowCallback=s,r===void 0&&(r=300),this.onTarget=!0,this.parent=e,this.waitTime=r,this.state=v.PopoverState.Showing;const{hoverEl:c}=this;this.abortController.load(),this.timer=window.setTimeout(this.show.bind(this),r),this.setActive=this._setActive.bind(this),c&&c.addEventListener("mousedown",this.setActive),G.set(this.hoverEl,this),this.hoverEl.addClass("dn-editor"),this.containerEl=this.hoverEl.createDiv("dn-content"),this.buildWindowControls(),this.setInitialDimensions()}static activeWindows(){const e=[window],{floatingSplit:i}=app.workspace;if(i)for(const o of i.children)o.win&&e.push(o.win);return e}static containerForDocument(e){if(e!==document&&app.workspace.floatingSplit){for(const i of app.workspace.floatingSplit.children)if(i.doc===e)return i}return app.workspace.rootSplit}static activePopovers(){return this.activeWindows().flatMap(this.popoversForWindow)}static popoversForWindow(e){var i,o;return Array.prototype.slice.call((o=(i=e==null?void 0:e.document)==null?void 0:i.body.querySelectorAll(".dn-leaf-view"))!=null?o:[]).map(r=>G.get(r)).filter(r=>r)}static forLeaf(e){const i=e&&document.body.matchParent.call(e.containerEl,".dn-leaf-view");return i?G.get(i):void 0}static iteratePopoverLeaves(e,i){for(const o of this.activePopovers())if(o.rootSplit&&e.iterateLeaves(i,o.rootSplit))return!0;return!1}_setActive(e){e.preventDefault(),e.stopPropagation(),this.plugin.app.workspace.setActiveLeaf(this.leaves()[0],{focus:!0})}getDefaultMode(){var e,i;return(i=(e=this.parent)==null?void 0:e.view)!=null&&i.getMode?this.parent.view.getMode():"preview"}updateLeaves(){this.onTarget&&this.targetEl&&!this.document.contains(this.targetEl)&&(this.onTarget=!1,this.transition());let e=0;this.plugin.app.workspace.iterateLeaves(i=>{e++},this.rootSplit),e===0&&this.hide(),this.hoverEl.setAttribute("data-leaf-count",e.toString())}leaves(){const e=[];return this.plugin.app.workspace.iterateLeaves(i=>{e.push(i)},this.rootSplit),e}setInitialDimensions(){this.hoverEl.style.height="auto",this.hoverEl.style.width="100%"}transition(){this.shouldShow()?this.state===v.PopoverState.Hiding&&(this.state=v.PopoverState.Shown,clearTimeout(this.timer)):this.state===v.PopoverState.Showing?this.hide():this.state===v.PopoverState.Shown&&(this.state=v.PopoverState.Hiding,this.timer=window.setTimeout(()=>{this.shouldShow()?this.transition():this.hide()},this.waitTime))}buildWindowControls(){this.titleEl=this.document.defaultView.createDiv("popover-titlebar"),this.titleEl.createDiv("popover-title"),this.containerEl.prepend(this.titleEl)}attachLeaf(){this.rootSplit.getRoot=()=>this.plugin.app.workspace[this.document===document?"rootSplit":"floatingSplit"],this.rootSplit.getContainer=()=>et.containerForDocument(this.document),this.titleEl.insertAdjacentElement("afterend",this.rootSplit.containerEl);const e=this.plugin.app.workspace.createLeafInParent(this.rootSplit,0);return this.updateLeaves(),e}onload(){super.onload(),this.registerEvent(this.plugin.app.workspace.on("layout-change",this.updateLeaves,this)),this.registerEvent(app.workspace.on("layout-change",()=>{this.rootSplit.children.forEach((e,i)=>{e instanceof v.WorkspaceTabs&&this.rootSplit.replaceChild(i,e.children[0])})}))}onShow(){var s,c;setTimeout(()=>this.waitTime=600,600),(s=this.oldPopover)==null||s.hide(),this.oldPopover=null,this.hoverEl.toggleClass("is-new",!0),this.document.body.addEventListener("click",()=>{this.hoverEl.toggleClass("is-new",!1)},{once:!0,capture:!0}),this.parent&&(this.parent.DailyNoteEditor=this);const i=this.hoverEl.querySelector(".view-header");i==null||i.remove();const o=this.hoverEl.querySelector(".workspace-leaf");o&&this.hoverEl.appendChild(o);const r=this.hoverEl.querySelector(".inline-title");r&&r.remove(),(c=this.onShowCallback)==null||c.call(this),this.onShowCallback=void 0}detect(e){const{targetEl:i,hoverEl:o}=this;i&&(this.onTarget=e===i||i.contains(e))}shouldShow(){return this.shouldShowSelf()||this.shouldShowChild()}shouldShowChild(){return et.activePopovers().some(e=>e!==this&&e.targetEl&&this.hoverEl.contains(e.targetEl)?e.shouldShow():!1)}shouldShowSelf(){return!this.detaching&&!!(this.onTarget||this.state==v.PopoverState.Shown||this.document.querySelector(`body>.modal-container, body > #he${this.id} ~ .menu, body > #he${this.id} ~ .suggestion-container`))}show(){!this.targetEl||this.document.body.contains(this.targetEl)?(this.state=v.PopoverState.Shown,this.timer=0,this.targetEl.appendChild(this.hoverEl),this.onShow(),app.workspace.onLayoutChange(),this.load()):this.hide(),this.hoverEl.dataset.imgHeight&&this.hoverEl.dataset.imgWidth&&(this.hoverEl.style.height=parseFloat(this.hoverEl.dataset.imgHeight)+this.titleEl.offsetHeight+"px",this.hoverEl.style.width=parseFloat(this.hoverEl.dataset.imgWidth)+"px")}onHide(){var e;this.oldPopover=null,((e=this.parent)==null?void 0:e.DailyNoteEditor)===this&&(this.parent.DailyNoteEditor=null)}hide(){var i;if(this.onTarget=!1,this.detaching=!0,this.timer&&(clearTimeout(this.timer),this.timer=0),this.hoverEl.hide(),this.opening)return;const e=this.leaves();if(e.length)e.forEach(o=>o.detach());else return this.parent=null,(i=this.abortController)==null||i.unload(),this.abortController=void 0,this.nativeHide()}nativeHide(){var o;const{hoverEl:e,targetEl:i}=this;if(this.state=v.PopoverState.Hidden,e.detach(),i){const r=i.matchParent(".dn-leaf-view");r&&((o=G.get(r))==null||o.transition())}this.onHide(),this.unload()}resolveLink(e,i){const o=v.parseLinktext(e);return o?this.plugin.app.metadataCache.getFirstLinkpathDest(o.path,i):null}async openLink(e,i,o,r){var p,h,f;let s=this.resolveLink(e,i);const c=v.parseLinktext(e);if(!s&&r){const y=this.plugin.app.fileManager.getNewFileParent(i);s=await this.plugin.app.fileManager.createNewMarkdownFile(y,c.path)}if(!s)return;const{viewRegistry:d}=this.plugin.app,a=d.typeByExtension[s.extension];if(!a||!d.viewByType[a])return;o=Object.assign(this.buildEphemeralState(s,c),o);const u=this.getDefaultMode(),l=this.buildState(u,o),w=await this.openFile(s,l,r),m=(p=w==null?void 0:w.view)==null?void 0:p.getViewType();if(m==="image"){((h=this.parent)==null?void 0:h.hasOwnProperty("editorEl"))&&this.parent.editorEl.hasClass("is-live-preview")&&(this.waitTime=3e3);const y=w.view.contentEl.querySelector("img");this.hoverEl.dataset.imgHeight=String(y.naturalHeight),this.hoverEl.dataset.imgWidth=String(y.naturalWidth),this.hoverEl.dataset.imgRatio=String(y.naturalWidth/y.naturalHeight)}else m==="pdf"&&(this.hoverEl.style.height="800px",this.hoverEl.style.width="600px");((f=l.state)==null?void 0:f.mode)==="source"&&this.whenShown(()=>{var y,b,M,ut;v.requireApiVersion("1.0")&&((M=(b=(y=w==null?void 0:w.view)==null?void 0:y.editMode)==null?void 0:b.reinit)==null||M.call(b)),(ut=w==null?void 0:w.view)==null||ut.setEphemeralState(l.eState)})}whenShown(e){if(this.detaching)return;const i=this.onShowCallback;this.onShowCallback=()=>{this.detaching||(e(),typeof i=="function"&&i())},this.state===v.PopoverState.Shown&&(this.onShowCallback(),this.onShowCallback=void 0)}async openFile(e,i,o){if(this.detaching)return;const r=o!=null?o:this.attachLeaf();this.opening=!0;try{await r.openFile(e,i)}catch(s){console.error(s)}finally{this.opening=!1,this.detaching&&this.hide()}return this.plugin.app.workspace.setActiveLeaf(r),r}buildState(e,i){return{active:!1,state:{mode:"source"},eState:i}}buildEphemeralState(e,i){const o=this.plugin.app.metadataCache.getFileCache(e),r=o?v.resolveSubpath(o,(i==null?void 0:i.subpath)||""):void 0,s={subpath:i==null?void 0:i.subpath};return r&&(s.line=r.start.line,s.startLoc=r.start,s.endLoc=r.end||void 0),s}};let C=et;_(C,"activePopover");const ue={root:null,rootMargin:"0px",threshold:0,unobserveOnEnter:!1},K=(t,n)=>new CustomEvent(t,{detail:n});function Tt(t,n={}){const{root:e,rootMargin:i,threshold:o,unobserveOnEnter:r}=Object.assign(Object.assign({},ue),n);let s={x:void 0,y:void 0},c={vertical:void 0,horizontal:void 0};if(typeof IntersectionObserver<"u"&&t){const d=new IntersectionObserver((a,u)=>{a.forEach(l=>{s.y>l.boundingClientRect.y?c.vertical="up":c.vertical="down",s.x>l.boundingClientRect.x?c.horizontal="left":c.horizontal="right",s={y:l.boundingClientRect.y,x:l.boundingClientRect.x};const w={inView:l.isIntersecting,entry:l,scrollDirection:c,node:t,observer:u};t.dispatchEvent(K("change",w)),l.isIntersecting?(t.dispatchEvent(K("enter",w)),r&&u.unobserve(t)):t.dispatchEvent(K("leave",w))})},{root:e,rootMargin:i,threshold:o});return setTimeout(()=>{t.dispatchEvent(K("init",{observer:d,node:t}))},0),d.observe(t),{destroy(){d.unobserve(t)}}}}function gt(t){let n,e,i,o;return{c(){n=S("div"),e=Ft(t[1]),F(n,"class","daily-note-title svelte-y39958"),F(n,"aria-hidden","true")},m(r,s){V(r,n,s),N(n,e),i||(o=R(n,"click",t[2]),i=!0)},p(r,s){s&2&&te(e,r[1])},d(r){r&&T(n),i=!1,o()}}}function fe(t){let n,e,i,o,r,s,c,d,a=t[1]&&gt(t);return{c(){n=S("div"),e=S("div"),a&&a.c(),i=W(),o=S("div"),r=W(),s=S("div"),F(o,"class","daily-note-editor"),F(e,"class","daily-note svelte-y39958"),F(n,"class","daily-note-container")},m(u,l){V(u,n,l),N(n,e),a&&a.m(e,null),N(e,i),N(e,o),t[8](o),N(n,r),N(n,s),c||(d=[Lt(Tt.call(null,s,{})),R(s,"leave",t[3]),R(s,"enter",t[4])],c=!0)},p(u,[l]){u[1]?a?a.p(u,l):(a=gt(u),a.c(),a.m(e,i)):a&&(a.d(1),a=null)},i:O,o:O,d(u){u&&T(n),a&&a.d(),t[8](null),c=!1,D(d)}}}function he(t,n,e){let{file:i}=n,{plugin:o}=n,{leaf:r}=n,s,c,d=!1,a;function u(){d||(a=de(o,s,r),a.setPinned(!0),i instanceof v.TFile&&(a.openFile(i,{active:!1}),e(1,c=i.basename)),d=!0)}function l(){i instanceof v.TFile&&(r?r.openFile(i):app.workspace.getLeaf(!1).openFile(i))}function w(h){const{scrollDirection:f}=h.detail;f.vertical==="up"&&(d=!1,s.empty())}function m(h){const{scrollDirection:f}=h.detail;f.vertical==="down"&&u()}function p(h){it[h?"unshift":"push"](()=>{s=h,e(0,s)})}return t.$$set=h=>{"file"in h&&e(5,i=h.file),"plugin"in h&&e(6,o=h.plugin),"leaf"in h&&e(7,r=h.leaf)},t.$$.update=()=>{t.$$.dirty&33&&i&&s&&u()},[s,c,l,w,m,i,o,r,p]}class pe extends Ot{constructor(n){super(),Ct(this,n,he,fe,bt,{file:5,plugin:6,leaf:7})}}var g={};Object.defineProperty(g,"__esModule",{value:!0});var k=Gt.default;const at="YYYY-MM-DD",lt="gggg-[W]ww",At="YYYY-MM",xt="YYYY-[Q]Q",It="YYYY";function q(t){var e,i;const n=window.app.plugins.getPlugin("periodic-notes");return n&&((i=(e=n.settings)==null?void 0:e[t])==null?void 0:i.enabled)}function B(){var t,n,e,i;try{const{internalPlugins:o,plugins:r}=window.app;if(q("daily")){const{format:a,folder:u,template:l}=((n=(t=r.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:n.daily)||{};return{format:a||at,folder:(u==null?void 0:u.trim())||"",template:(l==null?void 0:l.trim())||""}}const{folder:s,format:c,template:d}=((i=(e=o.getPluginById("daily-notes"))==null?void 0:e.instance)==null?void 0:i.options)||{};return{format:c||at,folder:(s==null?void 0:s.trim())||"",template:(d==null?void 0:d.trim())||""}}catch(o){console.info("No custom daily note settings found!",o)}}function U(){var t,n,e,i,o,r,s;try{const c=window.app.plugins,d=(t=c.getPlugin("calendar"))==null?void 0:t.options,a=(e=(n=c.getPlugin("periodic-notes"))==null?void 0:n.settings)==null?void 0:e.weekly;if(q("weekly"))return{format:a.format||lt,folder:((i=a.folder)==null?void 0:i.trim())||"",template:((o=a.template)==null?void 0:o.trim())||""};const u=d||{};return{format:u.weeklyNoteFormat||lt,folder:((r=u.weeklyNoteFolder)==null?void 0:r.trim())||"",template:((s=u.weeklyNoteTemplate)==null?void 0:s.trim())||""}}catch(c){console.info("No custom weekly note settings found!",c)}}function j(){var n,e,i,o;const t=window.app.plugins;try{const r=q("monthly")&&((e=(n=t.getPlugin("periodic-notes"))==null?void 0:n.settings)==null?void 0:e.monthly)||{};return{format:r.format||At,folder:((i=r.folder)==null?void 0:i.trim())||"",template:((o=r.template)==null?void 0:o.trim())||""}}catch(r){console.info("No custom monthly note settings found!",r)}}function $(){var n,e,i,o;const t=window.app.plugins;try{const r=q("quarterly")&&((e=(n=t.getPlugin("periodic-notes"))==null?void 0:n.settings)==null?void 0:e.quarterly)||{};return{format:r.format||xt,folder:((i=r.folder)==null?void 0:i.trim())||"",template:((o=r.template)==null?void 0:o.trim())||""}}catch(r){console.info("No custom quarterly note settings found!",r)}}function z(){var n,e,i,o;const t=window.app.plugins;try{const r=q("yearly")&&((e=(n=t.getPlugin("periodic-notes"))==null?void 0:n.settings)==null?void 0:e.yearly)||{};return{format:r.format||It,folder:((i=r.folder)==null?void 0:i.trim())||"",template:((o=r.template)==null?void 0:o.trim())||""}}catch(r){console.info("No custom yearly note settings found!",r)}}function Wt(...t){let n=[];for(let i=0,o=t.length;i<o;i++)n=n.concat(t[i].split("/"));const e=[];for(let i=0,o=n.length;i<o;i++){const r=n[i];!r||r==="."||e.push(r)}return n[0]===""&&e.unshift(""),e.join("/")}function ge(t){let n=t.substring(t.lastIndexOf("/")+1);return n.lastIndexOf(".")!=-1&&(n=n.substring(0,n.lastIndexOf("."))),n}async function we(t){const n=t.replace(/\\/g,"/").split("/");if(n.pop(),n.length){const e=Wt(...n);window.app.vault.getAbstractFileByPath(e)||await window.app.vault.createFolder(e)}}async function Q(t,n){n.endsWith(".md")||(n+=".md");const e=k.normalizePath(Wt(t,n));return await we(e),e}async function A(t){const{metadataCache:n,vault:e}=window.app,i=k.normalizePath(t);if(i==="/")return Promise.resolve(["",null]);try{const o=n.getFirstLinkpathDest(i,""),r=await e.cachedRead(o),s=window.app.foldManager.load(o);return[r,s]}catch(o){return console.error(`Failed to read the daily note template '${i}'`,o),new k.Notice("Failed to read the daily note template"),["",null]}}function E(t,n="day"){const e=t.clone().startOf(n).format();return`${n}-${e}`}function Ht(t){return t.replace(/\[[^\]]*\]/g,"")}function me(t,n){if(n==="week"){const e=Ht(t);return/w{1,2}/i.test(e)&&(/M{1,4}/.test(e)||/D{1,4}/.test(e))}return!1}function x(t,n){return Yt(t.basename,n)}function ye(t,n){return Yt(ge(t),n)}function Yt(t,n){const i={day:B,week:U,month:j,quarter:$,year:z}[n]().format.split("/").pop(),o=window.moment(t,i,!0);if(!o.isValid())return null;if(me(i,n)&&n==="week"){const r=Ht(i);if(/w{1,2}/i.test(r))return window.moment(t,i.replace(/M{1,4}/g,"").replace(/D{1,4}/g,""),!1)}return o}class ve extends Error{}async function Rt(t){const n=window.app,{vault:e}=n,i=window.moment,{template:o,format:r,folder:s}=B(),[c,d]=await A(o),a=t.format(r),u=await Q(s,a);try{const l=await e.create(u,c.replace(/{{\s*date\s*}}/gi,a).replace(/{{\s*time\s*}}/gi,i().format("HH:mm")).replace(/{{\s*title\s*}}/gi,a).replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(w,m,p,h,f,y)=>{const b=i(),M=t.clone().set({hour:b.get("hour"),minute:b.get("minute"),second:b.get("second")});return p&&M.add(parseInt(h,10),f),y?M.format(y.substring(1).trim()):M.format(r)}).replace(/{{\s*yesterday\s*}}/gi,t.clone().subtract(1,"day").format(r)).replace(/{{\s*tomorrow\s*}}/gi,t.clone().add(1,"d").format(r)));return n.foldManager.save(l,d),l}catch(l){console.error(`Failed to create file: '${u}'`,l),new k.Notice("Unable to create new file.")}}function _e(t,n){var e;return(e=n[E(t,"day")])!=null?e:null}function ke(){const{vault:t}=window.app,{folder:n}=B(),e=t.getAbstractFileByPath(k.normalizePath(n));if(!e)throw new ve("Failed to find daily notes folder");const i={};return k.Vault.recurseChildren(e,o=>{if(o instanceof k.TFile){const r=x(o,"day");if(r){const s=E(r,"day");i[s]=o}}}),i}class Ee extends Error{}function Ne(){const{moment:t}=window;let n=t.localeData()._week.dow;const e=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];for(;n;)e.push(e.shift()),n--;return e}function Se(t){return Ne().indexOf(t.toLowerCase())}async function Vt(t){const{vault:n}=window.app,{template:e,format:i,folder:o}=U(),[r,s]=await A(e),c=t.format(i),d=await Q(o,c);try{const a=await n.create(d,r.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(u,l,w,m,p,h)=>{const f=window.moment(),y=t.clone().set({hour:f.get("hour"),minute:f.get("minute"),second:f.get("second")});return w&&y.add(parseInt(m,10),p),h?y.format(h.substring(1).trim()):y.format(i)}).replace(/{{\s*title\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\s*:(.*?)}}/gi,(u,l,w)=>{const m=Se(l);return t.weekday(m).format(w.trim())}));return window.app.foldManager.save(a,s),a}catch(a){console.error(`Failed to create file: '${d}'`,a),new k.Notice("Unable to create new file.")}}function be(t,n){var e;return(e=n[E(t,"week")])!=null?e:null}function Le(){const t={};if(!Bt())return t;const{vault:n}=window.app,{folder:e}=U(),i=n.getAbstractFileByPath(k.normalizePath(e));if(!i)throw new Ee("Failed to find weekly notes folder");return k.Vault.recurseChildren(i,o=>{if(o instanceof k.TFile){const r=x(o,"week");if(r){const s=E(r,"week");t[s]=o}}}),t}class Fe extends Error{}async function qt(t){const{vault:n}=window.app,{template:e,format:i,folder:o}=j(),[r,s]=await A(e),c=t.format(i),d=await Q(o,c);try{const a=await n.create(d,r.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(u,l,w,m,p,h)=>{const f=window.moment(),y=t.clone().set({hour:f.get("hour"),minute:f.get("minute"),second:f.get("second")});return w&&y.add(parseInt(m,10),p),h?y.format(h.substring(1).trim()):y.format(i)}).replace(/{{\s*date\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,c));return window.app.foldManager.save(a,s),a}catch(a){console.error(`Failed to create file: '${d}'`,a),new k.Notice("Unable to create new file.")}}function Pe(t,n){var e;return(e=n[E(t,"month")])!=null?e:null}function De(){const t={};if(!Ut())return t;const{vault:n}=window.app,{folder:e}=j(),i=n.getAbstractFileByPath(k.normalizePath(e));if(!i)throw new Fe("Failed to find monthly notes folder");return k.Vault.recurseChildren(i,o=>{if(o instanceof k.TFile){const r=x(o,"month");if(r){const s=E(r,"month");t[s]=o}}}),t}class Me extends Error{}async function Ce(t){const{vault:n}=window.app,{template:e,format:i,folder:o}=$(),[r,s]=await A(e),c=t.format(i),d=await Q(o,c);try{const a=await n.create(d,r.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(u,l,w,m,p,h)=>{const f=window.moment(),y=t.clone().set({hour:f.get("hour"),minute:f.get("minute"),second:f.get("second")});return w&&y.add(parseInt(m,10),p),h?y.format(h.substring(1).trim()):y.format(i)}).replace(/{{\s*date\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,c));return window.app.foldManager.save(a,s),a}catch(a){console.error(`Failed to create file: '${d}'`,a),new k.Notice("Unable to create new file.")}}function Oe(t,n){var e;return(e=n[E(t,"quarter")])!=null?e:null}function Te(){const t={};if(!jt())return t;const{vault:n}=window.app,{folder:e}=$(),i=n.getAbstractFileByPath(k.normalizePath(e));if(!i)throw new Me("Failed to find quarterly notes folder");return k.Vault.recurseChildren(i,o=>{if(o instanceof k.TFile){const r=x(o,"quarter");if(r){const s=E(r,"quarter");t[s]=o}}}),t}class Ae extends Error{}async function xe(t){const{vault:n}=window.app,{template:e,format:i,folder:o}=z(),[r,s]=await A(e),c=t.format(i),d=await Q(o,c);try{const a=await n.create(d,r.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(u,l,w,m,p,h)=>{const f=window.moment(),y=t.clone().set({hour:f.get("hour"),minute:f.get("minute"),second:f.get("second")});return w&&y.add(parseInt(m,10),p),h?y.format(h.substring(1).trim()):y.format(i)}).replace(/{{\s*date\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,c));return window.app.foldManager.save(a,s),a}catch(a){console.error(`Failed to create file: '${d}'`,a),new k.Notice("Unable to create new file.")}}function Ie(t,n){var e;return(e=n[E(t,"year")])!=null?e:null}function We(){const t={};if(!$t())return t;const{vault:n}=window.app,{folder:e}=z(),i=n.getAbstractFileByPath(k.normalizePath(e));if(!i)throw new Ae("Failed to find yearly notes folder");return k.Vault.recurseChildren(i,o=>{if(o instanceof k.TFile){const r=x(o,"year");if(r){const s=E(r,"year");t[s]=o}}}),t}function He(){var i,o;const{app:t}=window,n=t.internalPlugins.plugins["daily-notes"];if(n&&n.enabled)return!0;const e=t.plugins.getPlugin("periodic-notes");return e&&((o=(i=e.settings)==null?void 0:i.daily)==null?void 0:o.enabled)}function Bt(){var e,i;const{app:t}=window;if(t.plugins.getPlugin("calendar"))return!0;const n=t.plugins.getPlugin("periodic-notes");return n&&((i=(e=n.settings)==null?void 0:e.weekly)==null?void 0:i.enabled)}function Ut(){var e,i;const{app:t}=window,n=t.plugins.getPlugin("periodic-notes");return n&&((i=(e=n.settings)==null?void 0:e.monthly)==null?void 0:i.enabled)}function jt(){var e,i;const{app:t}=window,n=t.plugins.getPlugin("periodic-notes");return n&&((i=(e=n.settings)==null?void 0:e.quarterly)==null?void 0:i.enabled)}function $t(){var e,i;const{app:t}=window,n=t.plugins.getPlugin("periodic-notes");return n&&((i=(e=n.settings)==null?void 0:e.yearly)==null?void 0:i.enabled)}function Ye(t){const n={day:B,week:U,month:j,quarter:$,year:z}[t];return n()}function Re(t,n){return{day:Rt,month:qt,week:Vt}[t](n)}g.DEFAULT_DAILY_NOTE_FORMAT=at;g.DEFAULT_MONTHLY_NOTE_FORMAT=At;g.DEFAULT_QUARTERLY_NOTE_FORMAT=xt;g.DEFAULT_WEEKLY_NOTE_FORMAT=lt;g.DEFAULT_YEARLY_NOTE_FORMAT=It;g.appHasDailyNotesPluginLoaded=He;g.appHasMonthlyNotesPluginLoaded=Ut;g.appHasQuarterlyNotesPluginLoaded=jt;g.appHasWeeklyNotesPluginLoaded=Bt;g.appHasYearlyNotesPluginLoaded=$t;g.createDailyNote=Rt;g.createMonthlyNote=qt;g.createPeriodicNote=Re;g.createQuarterlyNote=Ce;g.createWeeklyNote=Vt;g.createYearlyNote=xe;var Ve=g.getAllDailyNotes=ke;g.getAllMonthlyNotes=De;g.getAllQuarterlyNotes=Te;g.getAllWeeklyNotes=Le;g.getAllYearlyNotes=We;g.getDailyNote=_e;g.getDailyNoteSettings=B;g.getDateFromFile=x;g.getDateFromPath=ye;g.getDateUID=E;g.getMonthlyNote=Pe;g.getMonthlyNoteSettings=j;g.getPeriodicNoteSettings=Ye;g.getQuarterlyNote=Oe;g.getQuarterlyNoteSettings=$;g.getTemplateInfo=A;g.getWeeklyNote=be;g.getWeeklyNoteSettings=U;g.getYearlyNote=Ie;g.getYearlyNoteSettings=z;function wt(t,n,e){const i=t.slice();return i[8]=n[e],i}function mt(t){let n;return{c(){n=S("div"),F(n,"class","dn-stock svelte-17ka549")},m(e,i){V(e,n,i)},d(e){e&&T(n)}}}function yt(t){let n,e;return n=new pe({props:{file:t[8],plugin:t[0],leaf:t[1]}}),{c(){se(n.$$.fragment)},m(i,o){Dt(n,i,o),e=!0},p(i,o){const r={};o&8&&(r.file=i[8]),o&1&&(r.plugin=i[0]),o&2&&(r.leaf=i[1]),n.$set(r)},i(i){e||(Y(n.$$.fragment,i),e=!0)},o(i){st(n.$$.fragment,i),e=!1},d(i){Mt(n,i)}}}function vt(t){let n;return{c(){n=S("div"),n.textContent="\u2014\u2014 No more of results \u2014\u2014",F(n,"class","no-more-text svelte-17ka549")},m(e,i){V(e,n,i)},d(e){e&&T(n)}}}function qe(t){let n,e,i,o,r,s,c,d,a=t[3].length===0&&mt(),u=t[3],l=[];for(let p=0;p<u.length;p+=1)l[p]=yt(wt(t,u,p));const w=p=>st(l[p],1,1,()=>{l[p]=null});let m=!t[2]&&vt();return{c(){n=S("div"),a&&a.c(),e=W();for(let p=0;p<l.length;p+=1)l[p].c();i=W(),o=S("div"),r=W(),m&&m.c(),F(n,"class","daily-note-view")},m(p,h){V(p,n,h),a&&a.m(n,null),N(n,e);for(let f=0;f<l.length;f+=1)l[f].m(n,null);N(n,i),N(n,o),N(n,r),m&&m.m(n,null),s=!0,c||(d=[Lt(Tt.call(null,o,{})),R(o,"init",t[4]),R(o,"change",t[4])],c=!0)},p(p,[h]){if(p[3].length===0?a||(a=mt(),a.c(),a.m(n,e)):a&&(a.d(1),a=null),h&11){u=p[3];let f;for(f=0;f<u.length;f+=1){const y=wt(p,u,f);l[f]?(l[f].p(y,h),Y(l[f],1)):(l[f]=yt(y),l[f].c(),Y(l[f],1),l[f].m(n,i))}for(oe(),f=u.length;f<l.length;f+=1)w(f);re()}p[2]?m&&(m.d(1),m=null):m||(m=vt(),m.c(),m.m(n,null))},i(p){if(!s){for(let h=0;h<u.length;h+=1)Y(l[h]);s=!0}},o(p){l=l.filter(Boolean);for(let h=0;h<l.length;h+=1)st(l[h]);s=!1},d(p){p&&T(n),a&&a.d(),Jt(l,p),m&&m.d(),c=!1,D(d)}}}let Be=1;function Ue(t,n,e){let{plugin:i}=n,{leaf:o}=n,r=[],s=[],c=!0,d=!1;function a(){!d||!c||(s.length===0&&d?e(2,c=!1):e(3,r=[...r,...s.splice(0,Be)]))}function u(){e(3,r)}return t.$$set=l=>{"plugin"in l&&e(0,i=l.plugin),"leaf"in l&&e(1,o=l.leaf)},t.$$.update=()=>{if(t.$$.dirty&68&&c&&!d){const l=Ve();for(const w in l)s.push(l[w]);e(6,d=!0)}},[i,o,c,r,a,u,d]}class je extends Ot{constructor(n){super(),Ct(this,n,Ue,qe,bt,{plugin:0,leaf:1,tick:5})}get tick(){return this.$$.ctx[5]}}function J(t,n){const e=Object.keys(n).map(i=>$e(t,i,n[i]));return e.length===1?e[0]:function(){e.forEach(i=>i())}}function $e(t,n,e){const i=t[n],o=t.hasOwnProperty(n);let r=e(i);return i&&Object.setPrototypeOf(r,i),Object.setPrototypeOf(s,r),t[n]=s,c;function s(...d){return r===i&&t[n]===s&&c(),r.apply(this,d)}function c(){t[n]===s&&(o?t[n]=i:delete t[n]),r!==i&&(r=i,Object.setPrototypeOf(s,i||Function))}}const ze=()=>{v.addIcon("daily-note",'<svg width="103" height="134" viewBox="0 0 103 134" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M60.3446 21.848H22.5577C19.5764 21.848 17.1595 24.2648 17.1595 27.2462V65.0331C17.1595 68.0144 19.5764 70.4312 22.5577 70.4312H60.3446C63.3259 70.4312 65.7428 68.0144 65.7428 65.0331V27.2462C65.7428 24.2648 63.3259 21.848 60.3446 21.848Z" stroke="#5C1111" stroke-width="4.81618" stroke-linecap="round" stroke-linejoin="round"/><path d="M52.2476 16.4498V27.2461" stroke="#5C1111" stroke-width="4.81618" stroke-linecap="round" stroke-linejoin="round"/><path d="M30.655 16.4498V27.2461" stroke="#5C1111" stroke-width="4.81618" stroke-linecap="round" stroke-linejoin="round"/><path d="M17.1595 38.0424H65.7428" stroke="#5C1111" stroke-width="4.81618" stroke-linecap="round" stroke-linejoin="round"/><path d="M33.3541 54.2366L38.7523 59.6348L49.5485 48.8385" stroke="#5C1111" stroke-width="4.81618" stroke-linecap="round" stroke-linejoin="round"/><g filter="url(#filter0_ddddd_104_2)"><path d="M12.181 103.617L9.21851 95.8213L27.9292 87.0896L66.754 71.4973L93.1049 88.8047L91.3898 103.617H12.181Z" fill="#AC4DD9" stroke="black" stroke-width="0.963236"/><path d="M12.181 103.617L9.21851 95.9771L27.9292 87.0895L32.6069 103.461L12.181 103.617Z" fill="#540D75" stroke="black" stroke-width="0.963236"/><path d="M9.0625 95.6652L25.7894 67.212L27.9291 87.0894L9.21842 95.977L9.0625 95.6652Z" fill="#470068" stroke="black" stroke-width="0.481618"/><path d="M27.9291 87.0896L25.9021 66.8197L67.5335 56.2169L66.5979 71.4973L27.9291 87.0896Z" fill="#732E94" stroke="black" stroke-width="0.963236"/><path d="M66.598 71.4971L67.9466 56.3527L93.1049 88.8045L66.598 71.4971Z" fill="#C279E4" stroke="black" stroke-width="0.481618"/><path d="M9.0625 95.6652L25.7462 66.8195L67.9465 56.0808L93.1049 88.8046L66.598 71.4972L27.9291 87.0895L9.21842 95.9771L9.0625 95.6652Z" stroke="black" stroke-width="0.963236"/><path d="M26.0579 103.617L27.9289 87.0895L32.7625 103.617H26.0579Z" fill="#61018E" stroke="black" stroke-width="0.963236"/></g><defs><filter id="filter0_ddddd_104_2" x="0.0874329" y="53.8502" width="101.958" height="79.8707" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"/><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_104_2"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dy="1.20405"/><feGaussianBlur stdDeviation="1.44485"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"/><feBlend mode="normal" in2="effect1_dropShadow_104_2" result="effect2_dropShadow_104_2"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dy="5.2978"/><feGaussianBlur stdDeviation="2.6489"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.09 0"/><feBlend mode="normal" in2="effect2_dropShadow_104_2" result="effect3_dropShadow_104_2"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dy="11.7996"/><feGaussianBlur stdDeviation="3.61213"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.05 0"/><feBlend mode="normal" in2="effect3_dropShadow_104_2" result="effect4_dropShadow_104_2"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dy="21.1912"/><feGaussianBlur stdDeviation="4.21416"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.01 0"/><feBlend mode="normal" in2="effect4_dropShadow_104_2" result="effect5_dropShadow_104_2"/><feBlend mode="normal" in="SourceGraphic" in2="effect5_dropShadow_104_2" result="shape"/></filter></defs></svg>')},L="daily-note-editor-view";class Qe extends v.ItemView{constructor(e,i){super(e);_(this,"view");_(this,"plugin");this.plugin=i}getViewType(){return L}getDisplayText(){return"Daily Note"}getIcon(){return"daily-note"}async onOpen(){this.view=new je({target:this.contentEl,props:{plugin:this.plugin,leaf:this.leaf}}),this.app.workspace.onLayoutReady(this.view.tick.bind(this))}}class Ze extends v.Plugin{constructor(){super(...arguments);_(this,"view");_(this,"lastActiveFile")}async onload(){this.patchWorkspace(),this.patchWorkspaceLeaf(),ze(),this.registerView(L,e=>this.view=new Qe(e,this)),this.app.workspace.onLayoutReady(this.onLayoutReady.bind(this)),this.addRibbonIcon("daily-note","Open Daily Note Editor",e=>this.openDailyNoteEditor()),this.addCommand({id:"open-daily-note-editor",name:"Open Daily Note Editor",callback:()=>this.openDailyNoteEditor()})}onLayoutReady(){this.app.workspace.getLeavesOfType(L).length||this.app.workspace.getLeaf().setViewState({type:L})}onunload(){this.app.workspace.detachLeavesOfType(L)}async openDailyNoteEditor(){const e=this.app.workspace;e.detachLeavesOfType(L);const i=e.getLeaf();await i.setViewState({type:L}),e.revealLeaf(i)}patchWorkspace(){let e=!1;const i=J(v.Workspace.prototype,{changeLayout(o){return async function(r){e=!0;try{await o.call(this,r)}finally{e=!1}}},iterateLeaves(o){return function(r,s){if(o.call(this,r,s))return!0;const c=typeof r=="function"?r:s,d=typeof r=="function"?s:r;if(!d||e)return!1;if(d===app.workspace.rootSplit||v.WorkspaceContainer&&d instanceof v.WorkspaceContainer){for(const a of C.popoversForWindow(d.win))if(o.call(this,c,a.rootSplit))return!0}return!1}},getDropLocation(o){return function(s){for(const c of C.activePopovers()){const d=this.recursiveGetTarget(s,c.rootSplit);if(d)return d}return o.call(this,s)}},onDragLeaf(o){return function(r,s){return o.call(this,r,s)}}});this.register(i)}patchWorkspaceLeaf(){this.register(J(v.WorkspaceLeaf.prototype,{getRoot(e){return function(){const i=e.call(this);return i.getRoot===this.getRoot?i:i.getRoot()}},setPinned(e){return function(i){e.call(this,i),pt(this)&&!i&&this.setPinned(!0)}},openFile(e){return function(i,o){if(pt(this)){setTimeout(J(v.Workspace.prototype,{recordMostRecentOpenedFile(s){return function(c){if(console.log(c,i),c!==i)return s.call(this,c)}}}),1);const r=this.app.plugins.plugins["recent-files-obsidian"];r&&setTimeout(J(r,{shouldAddFile(s){return function(c){return c!==i&&s.call(this,c)}}}),1)}return e.call(this,i,o)}}}))}}exports.DAILY_NOTE_VIEW_TYPE=L;exports.default=Ze;
